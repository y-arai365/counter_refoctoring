個数カウントシステム
===
## バージョン情報

### バージョン2.6.0-hls(2022/05/10)
#### 変更点
* カメラを1000万画素に変更
#### 追加機能
* 許容歩留率の登録機能
* 計数結果が許容歩留率を下回った際の通知機能
* シートごとのラベル印刷機能

#### 変更点
* カメラが2000万画素に変更。
    * それに伴い装置も変更、画角が変わり撮影範囲の描画を廃止。
    * カメラの設定ファイルをxml形式に変更。
* シートナンバーを数字のみに変更。
#### 追加機能
* HLSの範囲指定による過検出抑制機能の追加。
#### 修正点
* ポップアップが出た際、カメラ映像の更新が止まることがあったが修正。


#### 機能追加、変更点
* カウントアルゴリズムのパターンマッチングで閾値を変更できるようになりました。
    * 今までは全ての製品が同じ閾値でのパターンマッチングを行っていましたが、製品ごとに設定できるようになりました。
    * メインウィンドウで変更したい製品名を選択した状態で、メニューバーの設定を押すことでその製品の閾値変更を行えます。
    * 閾値が上がるほどマッチングしづらくなり、下がるほどマッチングしやすくなります。
    * 新規でのカウント結果表示中に設定ウィンドウを開くとテストカウントができます。
        * 閾値を変更して、テストカウントを行うと、変更した数値でのカウントを行った結果がメインウィンドウに表示されます。
        * 変更ボタンを押さずに設定ウィンドウを閉じると、元の閾値での再カウントが行われます。
    * 設定ウィンドウを開いているときは、カウントスタート、確認、製品名の変更を行うことはできません。

#### 画面追加、変更点
* メニューバーに設定ボタンが追加されました。
* 設定ウィンドウ
    * マッチングの閾値の変更部分はスクロールバーによって行えます。
    * テストカウントボタンはカウント結果を表示中にのみアクティブになります。
    * 変更ボタンで表示中の製品の閾値を変更することができます。
    
---
### バージョン2.4.3(2020/10/12)
#### 機能追加、変更点
* 輪郭抽出機能のついたソフトを2.4.2にアップデートしました。

---
### バージョン2.4.2(2020/03/10)
#### 機能追加、変更点
* カメラのオート露光の設定を初回時に手動でオフにする必要がありましたが、自動的にオフになるよう一部を変更しました。

---
### バージョン2.4.1(2020/03/05)
#### 機能追加、変更点
* 原因不明でカウントできないエラーの修正のためソフトの内部構造の一部を変更しました。
    * 使用上の変更はありません。
* カウント中にエラーが発生した場合、preprocessing_errorフォルダテキストファイルが出力されるようになりました。

---
### バージョン2.4.0(2020/02/20)
#### 機能追加、変更点
* 登録ウィンドウの右下パターントリミング部分にマウスホイール関数を導入しました。
    * 以前までは右上の拡大ボタンで画像を拡大していましたが、画像上でマウスホイールをすることで任意の倍率に拡大できます。
* 画像の保存場所が本日の日付になりました。
    * ソフトをつけっぱなしにして日をまたぐと、前日の日付で画像を保存していたので、本日の日付のディレクトリが存在しませんでした。
      今回の変更によってソフトが日をまたぐと次のカウント時に本日の日付のディレクトリが生成されます。
*  カウント前処理の製品回転部分が変更されました。
    * 製品が並んでいる全体形状が四角でないと回転できませんでしたが、回転できるようになりました。
    * 基本的には製品が整列していれば回転することができます。
    * 角度を決定するのに少し時間がかかる場合があります。
* 誤検出、未検出欄に数値を入力後エンターキーを押さなくても反映されるようになりました。
* 製品をカウントするタイミングが変更になりました。
    * カメラで撮影した画像を一度保存してからカウントするように変更しました。
    
#### 画面追加、変更点
* パターン登録ウィンドウ
    * 右下パターン登録部分に存在した拡大/戻るボタンが無くなりました。
---
### バージョン2.3.1(2019/12/04)
#### 機能追加、変更点
* 手法の選択ができるようになりました。
    * 今まではパターン検出のみでしたが、輪郭検出が追加されました。
    * 手法名のタブを選択、情報入力し、スタートボタンを押すと選択した手法でカウントすることができます。
* 輪郭検出について
    * 検出した領域は緑の枠線で囲われます。
    * 輪郭検出では製品以外の異物を除去するためにいくつかの設定項目を設けています。
        * 収縮量：小さな異物を除外します。
        * 膨張量：異物除去(設定した収縮量)により小さくなってしまった製品を元のサイズに戻します。
        * 除外面積：上記では取り切れなかったサイズの異物が存在した場合、こちらの値を設定することで取り除くことができます。
    * スタートボタンを押して一度カウントした後に、設定ウィンドウを開いて設定値を変更すると、  
      表示されている結果画像が変更されます。
    * 変更ボタンを押していただくと変更後の結果が保存されます。

#### 画面追加、変更点
* 右側の製品情報入力欄にタブが追加されました。
    * 「パターン検出」「輪郭検出」の2つがあります。
    * タブを押すと手法が切り替わります。
* メニューバーに「設定」が追加されました。
    * 設定ウィンドウを開きます。
* 設定ウィンドウが追加されました。
    * 輪郭検出で使用する項目である「収縮量」「膨張量」「除外面積」があります。この設定値を使用して輪郭検出は行われます。
---

### バージョン2.3.0(2019/07/25)
#### 機能追加、変更点
* マッチングコードの変更
    * マッチングのアルゴリズムが変更になりました。
    * エラー対応が変更になりました。「マッチングする製品が存在しません。」のエラーが無くなり  
     「マッチング中にエラーが起きました。」が追加されました。
    * 間違って撮影した場合(製品が無い状態で撮影など)、良品数0と表示され、結果が保存されます。
        * 結果は1度保存する必要があります。
        * 削除したい場合は、確認ボタンを押してから、開くでそのシート情報を開いて削除ボタンを押してください。
        * 結果としてそのまま残す場合は、シートNoを数字以外を含む名前に変更してから確認ボタンを押してください。
* HTML出力
    * メニューバーのHTML出力からカウント結果を出力できるようになりました。
    * 管理No、LotNoを入力するとtemplate.htmlに作業日、図番、Lot No、管理No、シートごとの良品数、  
    ロットのシート枚数,ロットの良品合計数に記入されます。Lot Noは空欄のままでも構いません。
    * 出力されるシートNoは番号部分が数字のみで構成されているものに限ります。  
      (1_1、3_3などは記入されません)
    * 入力されるのはカウントしたシートNoだけです。カウントしていないシートNoの欄は空欄になります。
    * HTML出力用のフォルダとしてcountフォルダ内にreportというフォルダを作成しました。  
      (C:\\Users\○○\□□\count\report\)
    * 管理Noを入力し、出力ボタンを押せば ”8ケタの日付-管理No.html” として、このフォルダに保存されます。  
    (e.g. 20190708-180-815.html)
    * 管理Noを入力した後、参照ボタンを押すことで指定のフォルダ、ファイル名で保存することもできます。
    * 出力ボタンを押した後、開くボタンを押すことでブラウザが立ち上がり、その場で保存したHTMLファイルを開くことができます。
* 結果保存タイミング
    * カウント後、確認ボタンを押すまでの間にシートNoを変更できるようになりました。
    * 結果として正しい数値が残せない場合(誤って撮影した場合、大量に誤検出が出た場合、未検出が出た場合)に
      数字以外の文字を含む名前で保存してください。(例：1_1、3_3など)

---
### バージョン2.2.1(2019/06/12)
#### 機能追加、変更点
* マッチングコードの軽微な変更  
    * コード内で正しいパターンを選ぶことができるように変更しました。
---
### バージョン2.2.0(2019/05/31)
#### 機能追加、変更点
* 誤検出・未検出入力機能
    * カウント結果表示欄に誤検出・未検出の入力欄が追加されました。
    * 誤検出・未検出数を入力すると良品数が変化します。
    * 誤検出・未検出欄はUp/Downキーで数字を変更可能です。  
      また、キーボードで数字を入力後Enterキーで数値を確定させることも可能です。
    * 未検出欄でTabキーを押すと、シートNoの入力欄に移ります。
* 結果画像の拡大/縮小
    * 結果画像の表示時に、画像上でマウスホイールを動かすと、1倍から最大6倍まで画像を拡大することができます。
    * 画像拡大時にマウスをドラッグすることで画像を動かすことができます。
* 理論数量・良品数比較機能
    * カウント結果を表示する際に、良品数が理論数量を上回っていると、良品数の個数表示が赤色に変わります。
    * 誤検出を増やすなどして良品数が理論数量以下の数値になると、文字色は黒色に戻ります。
* 結果保存フォルダ構成変更
    * 結果を保存していたフォルダが製品名ごとから、日付ごとに変更されました。
* エラーウィンドウを閉じる方法
    * エラーウィンドウの確認ボタン、×ボタン以外にもEnterキーを押すことで閉じることができるようになりました。
* 結果保存タイミングの変更
    * カウント後、確認ボタンを押さないと結果が保存されないようになりました。
    * 結果を保存せずにウィンドウを閉じようとする場合、エラーが返ってくるようになっています。  
      製品情報下の確認ボタンを押していただくことで、ウィンドウを閉じることができるようになります。  
      (開くから結果を開いた場合は、変更・削除ボタンを押していただいても構いません。)
      
#### 画面追加、変更点
* **メインウィンドウ**
    * 画像表示欄
        * マウスホイール・ドラッグ対応
    * カウント結果表示欄
        * 誤検出・未検出入力欄追加
---
### バージョン2.1.0(2019/05/24)
#### 機能追加、変更点
* 内部のパターンマッチング部分を変更  

---
### バージョン2.0.0(2019/05/15)
#### 機能追加、変更点
* 製品のパターンを登録
    * パターン登録欄に拡大機能追加
* 登録したパターンから良品数のみをカウント
    * マーキング数、歯抜け数のカウントを廃止
* 過去の結果閲覧機能
    * 結果のシートNo変更機能追加
    * 結果の削除機能追加
* カメラリフレッシュ機能追加
    * カメラとの接続が切断された場合(映像部分が黒画像になる)に使用
* キーボードでの操作追加
    * 一部がUp/DownキーとEnterキーで操作可能

#### 画面追加、変更点
* 背景グレー  
* **メインウィンドウ**
    * メニューバー
        * カメラリフレッシュ： カメラを再接続
    * LIVE/PHOTO表示： 削除
    * 初期カーソル位置： 作業者名記入欄
        * Tabキーで次の入力欄に進む
    * 製品情報入力欄
        * 新規/開くのラジオボタン： Enterキーで選択可能
            * 開く： 変更、削除ボタン追加
        * シートNo入力欄
            * Up/Downキー： シートNoの数値を1増減する
            * Enterキー： カウントスタート/確認(スタートボタン/確認ボタンと同じ役割)
    * カウント結果表示欄
        * 良品数のみの表示に変更
    * スタートボタン
        * 押下後： 赤色のカウント中…表示になる
    * サイズグリップ(右下)： 画面サイズ変更中は動画停止  
* **製品名登録ウィンドウ**
    * 製品情報登録欄
        * カウント項目部分： 削除
    * パターン登録欄
        * 拡大ボタン追加：　登録欄に表示される画像が拡大される

---
### バージョン1.0.0(2019/03/18)
#### 機能概要
* 製品のパターン(顔)を登録
    * 製品名以外の登録情報は変更可能
* 登録したパターンから、良品数をカウント
    * 製品を置く向きに関係なくカウント可能
    * マーキングのカウント
    * 理論数量、良品数(、カウント数)から歯抜け数を算出
* 結果画像の保存
* 結果数値のcsvファイル書き出し
* データベース連携
* 過去の結果閲覧機能

#### 画面
* 背景白  
* **メインウィンドウ**
    * メニューバー
        * 製品名登録： 製品登録画面を開く
        * ファイルの選択： ローカルからファイルを読み込む
        * 終了
    * LIVE/PHOTO確認表示
        * 動画の場合： 赤のLIVE
        * 画像の場合： 緑のPHOTO
    * 動画/画像表示
        * 動画： オレンジの検査枠表示
    * 作業者情報入力欄
    * 製品情報入力欄
        * 新規： 未カウントの製品のカウント
        * 開く： 過去のカウント結果呼び出し
    * カウント結果表示欄
    * スタートボタン
        * カウント終了時： 確認ボタン
    * サイズグリップ(右下)： ソフト画面サイズに合わせて画像表示部分拡大、ソフト配置修正  
* **製品名登録ウィンドウ**
    * 動画/画像表示
        * 画像表示の場合： パターンの範囲を指定可能
    * 選択/拡大ボタン
        * 選択ボタン： パターンの範囲を指定
        * 拡大ボタン： 表示画像の拡大、戻るを左クリックで行う
    * 製品情報登録欄
        * 変更： 登録済みの製品情報の変更、製品情報変更ボタン、パターン変更ボタンの表示
    * パターン登録欄
        * 矢印ボタン： パターン領域を1pxずつ増減させる
    * 登録ボタン  
* **サブウィンドウ**
    * エラーウィンドウ
        * メッセージカラー： 赤
    * 確認ウィンドウ
        * メッセージカラー： 水色  
 
